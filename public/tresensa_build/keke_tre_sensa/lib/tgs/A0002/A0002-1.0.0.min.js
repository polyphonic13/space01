/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */

TGS.Adapters.A0002=function(){TGS.Adapters.A0002.superclass.constructor.call(this);TGS.DataStore._sSaveToLocalStorage=true;TGS.DataStore._sSaveToTGSServer=false};TGS.Adapters.A0002.prototype={supportsMicrotransactions:function(){return true},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+((a*this.costFactor()/100)-0.01).toFixed(2)},requiredPartnerProperties:function(){return""},initialize:function(){this._mIsReady=true;if(this.onAdapterReady!==null){this.onAdapterReady.call()}TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter initialized.")},onInitSuccess:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter connected.");this.updateLocalStorageData();this.getLoginStatus()},onInitFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter init fails with "+a);this._mIsReady=false},connect:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter connecting...");inappbilling.init(this.onInitSuccess.bind(this),this.onInitFailed.bind(this))},onPurchaseSuccess:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase accepted. "+JSON.stringify(a));var c=TGS.Microtransactions._PendingRequest;if(c!=null){c.partnerTransactionID=a;var b=c.item.partnerProductID;inappbilling.consumePurchase(this.onConsumePurchaseSuccess.bind(this),this.onConsumePurchaseFailed.bind(this),b);TGS.Microtransactions._PartnerPurchaseSuccessful(c)}},onPurchaseFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase failed "+a);var c=TGS.Microtransactions._PendingRequest;if(c!=null){if(a.indexOf("Already Owned")>=0){var b=c.item.partnerProductID;TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase already owned invoking consume/purchase for "+b);inappbilling.consumePurchase(this.onConsumePurchaseSuccessRebuy.bind(this),this.onConsumePurchaseFailed.bind(this),b)}else{c.internalErrorMessage="Google Play status: "+a.status;TGS.Microtransactions._PartnerPurchaseFailed(c)}}},onConsumePurchaseSuccess:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consume purchase success.")},onConsumePurchaseSuccessRebuy:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consume purchase success but now we should rebuy this item.");var c=TGS.Microtransactions._PendingRequest;if(c!=null){var b=c.item.partnerProductID;inappbilling.buy(this.onPurchaseSuccess.bind(this),this.onPurchaseFailed.bind(this),b)}},onConsumePurchaseFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consume purchase failed "+a)},purchaseItem:function(b){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase request for "+b.item.id+" ("+b.item.partnerProductID+").");var a=b.item.partnerProductID;inappbilling.buy(this.onPurchaseSuccess.bind(this),this.onPurchaseFailed.bind(this),a)}};extend(TGS.Adapters.A0002,TGS.PartnerBridge);