<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.7.4.min.js"></script>
    <script defer="defer">
		function checkDirection(evt) {
			if(evt.x > origin.x) {
				console.log("FORWARD");
			} else {
				console.log("REVERSE");
			}
		}
		
		function onDragStart(evt) {
			// console.log('onDragStart, x/y = ' + evt.x + '/' + evt.y);
			checkDirection(evt);
		}

		function onDragMove(evt) {
			// console.log('onDragMove, x/y = ' + evt.x + '/' + evt.y);
			checkDirection(evt);
		}

		function onDragEnd(evt) {
			console.log('onDragEnd');
			smCircle.setPosition(origin.x, origin.y);
			layer.draw();
		}

			var origin = {
				x: 60,
				y: 60
			};

      var stage = new Kinetic.Stage({
        container: 'container',
        width: 578,
        height: 400
      });
      var layer = new Kinetic.Layer();


			var bg = new Kinetic.Rect({
				x: 0,
				y: 0,
				width: stage.getWidth(),
				height: stage.getHeight(),
				fill: '#123456',
				stroke: 'black',
				strokeWidth: 1
			});
			
			var lgCircle = new Kinetic.Circle({
				x: origin.x,
				y: origin.y,
				radius: 50,
				fill: '#666666',
				stroke: '#222222',
				strokeWidth: 2
			});

			var smCircle = new Kinetic.Circle({
				x: origin.x,
				y: origin.y,
				radius: 25,
				fill: '#cccccc',
				stroke: '#222222',
				strokeWidth: 2,
				draggable: true,
				dragBoundFunc: function(pos) {
	       var x = origin.x;  // your center point
	        var y = origin.y;  // your center point 
	        var radius = 25;
	        var scale = radius / Math.sqrt(Math.pow(pos.x - x, 2) + Math.pow(pos.y - y, 2)); // distance formula ratio
					var yScale = scale * 0.3;
					//console.log('scale = ' + scale);
	        if(scale < 1)
	          return {
	            y: Math.round((pos.y - y) * yScale + y),
	            x: Math.round((pos.x - x) * scale + x)
	          };
	        else
	          return pos;
					// return {
					// 	x: pos.x,
					// 	y: this.getAbsolutePosition().y
					// }
				}
			});

			smCircle.on('dragstart', function(evt) {
				console.log('DRAG START!');
				onDragStart(evt);
			});
			smCircle.on('dragmove', function(evt) {
				onDragMove(evt);
			});
			smCircle.on('dragend', function(evt) {
				onDragEnd();
			});
			
  		layer.add(bg);
			layer.add(lgCircle);
			layer.add(smCircle);
      stage.add(layer);

    </script>
  </body>
</html>