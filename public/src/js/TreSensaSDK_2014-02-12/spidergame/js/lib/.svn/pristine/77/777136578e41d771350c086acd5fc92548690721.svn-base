/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */

TGS.Adapters.A0021=function(){TGS.Adapters.A0021.superclass.constructor.call(this);this._mTestMode=false;this._mAllowSandboxMode=false;if(WinJS!=null){WinJS.Binding.optimizeBindingReferences=true;this.currentWinApp=null}};TGS.Adapters.A0021.prototype={supportsMicrotransactions:function(){return true},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+((a*this.costFactor()/100)-0.01).toFixed(2)},requiredPartnerProperties:function(){return""},initialize:function(){this._mIsReady=true;if(this.onAdapterReady!==null){this.onAdapterReady.call()}if(window.TGE!=null){var a=TGE.Game.GetInstance();if(a!=null){a.scaleToFitOnDesktop=true;a.centerHorizontallyOnDesktop=true;a.centerVerticallyOnDesktop=true}}TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter initialized.")},connect:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter connecting...");if(GameConfig.DEBUG||!GameConfig.PROD_ENV){this.currentWinApp=Windows.ApplicationModel.Store.CurrentAppSimulator}else{this.currentWinApp=Windows.ApplicationModel.Store.CurrentApp}if(this.currentWinApp!=null){var b=this.currentWinApp.licenseInformation;TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter is connected and we got license info");this.getLoginStatus()}else{TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter init failed");this._mIsReady=false}},onPurchaseSuccess:function(a){var d=this.currentWinApp.licenseInformation;if(d!=null){var c=d.productLicenses.lookup(a).isActive;TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase accepted for "+a);var b=TGS.Microtransactions._PendingRequest;if(b!=null){b.partnerTransactionID=a;TGS.Microtransactions._PartnerPurchaseSuccessful(b)}}},onPurchaseFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase failed "+a);var b=TGS.Microtransactions._PendingRequest;if(b!=null){b.internalErrorMessage="Windows Store status failed";TGS.Microtransactions._PartnerPurchaseFailed(b)}},purchaseItem:function(b){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase request for "+b.item.id+" ("+b.item.partnerProductID+").");var a=b.item.partnerProductID;if(a!=null&&a.length>0){if(this.currentWinApp!=null){this.currentWinApp.requestProductPurchaseAsync(a,false).then(this.onPurchaseSuccess.bind(this,a),this.onPurchaseFailed.bind(this,a))}else{TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Windows Store purchase not initialized")}}else{TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase request cannot be fulfilled no product id specified");this.onPurchaseFailed(a)}},};extend(TGS.Adapters.A0021,TGS.PartnerBridge);