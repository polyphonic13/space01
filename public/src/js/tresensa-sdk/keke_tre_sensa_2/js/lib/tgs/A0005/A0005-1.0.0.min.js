/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */

TGS.Adapters.A0005=function(){TGS.Adapters.A0005.superclass.constructor.call(this);this._mGameSecret=""};TGS.Adapters.A0005.prototype={supportsMicrotransactions:function(){return true},costFactor:function(){return 0.1},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()).toFixed(2)},logTransactionBeforePartnerRequest:function(){return false},initialize:function(){if(!window.GAMESAPI){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Games.com library has not been loaded")}this._mIsReady=true;if(this.onAdapterReady!==null){this.onAdapterReady.call()}},requiredPartnerProperties:function(){return'"gamescom_game_id","gamescom_game_secret"'},connect:function(a){this._mGameSecret=a.gamescom_game_secret;GAMESAPI.beginGameSession(this._onBeginSuccess.bind(this),this._onBeginError.bind(this))},_onBeginSuccess:function(a){if(a.statusCode!==200){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"could not connect to Games.com: error code "+a.statusCode);return}GAMESAPI.setGameSecret(this._mGameSecret);var b=a.data.playerInfo.playerId;if(this.onUserInfoAvailable!==null){this.onUserInfoAvailable.call(this,b)}},_onBeginError:function(a){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"could not connect to Games.com: "+a.statusText)},submitScore:function(a){},achievementEarned:function(a){},purchaseItem:function(b){if(TGS.BrowserDetect.isMobileDevice){b.internalErrorMessage="on mobile";b.userErrorMessage="In-app purchases cannot be made from a mobile device. Please try again on a desktop computer. Items purchased on desktop will be available when playing on mobile using your Games.com account.";TGS.Microtransactions._PartnerPurchaseFailed(b);return}var a=b.item;GAMESAPI.TRANSACTION.startTransaction(a.price*this.costFactor(),b.item.id,a.title,this._purchaseItemCallback.bind(this,b),this._onPurchaseError.bind(this,b))},_purchaseItemCallback:function(b,a){b.partnerTransactionID=a.data.orderId;TGS.Debug.Log(TGS.Debug.LOG_INFO,"Games.com approved purchase of transaction "+b.transactionID);TGS.Microtransactions._PartnerPurchaseSuccessful(b)},_onPurchaseError:function(b,a){b.internalErrorMessage=a.statusCode+" - "+a.statusText;if(a.statusCode===475){b.userErrorMessage=""}TGS.Microtransactions._PartnerPurchaseFailed(b)}};extend(TGS.Adapters.A0005,TGS.PartnerBridge);